(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{347:function(t,a,s){"use strict";s.r(a);var e=s(14),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"configdeliver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configdeliver"}},[t._v("#")]),t._v(" ConfigDeliver")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/gcslaoli/config-deliver",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"项目介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目介绍"}},[t._v("#")]),t._v(" 项目介绍")]),t._v(" "),a("p",[t._v("工作中经常会遇到需要将配置文件分发到各个服务器的情况，这个项目就是为了解决这个问题而诞生的。目前本项目在作者的工作中主要用于分发域名证书、以及为 traefik 提供 http provider 的配置文件。")]),t._v(" "),a("p",[t._v("ConfigDeliver 采用客户端/服务端模式，服务端开启一个 HTTP 服务，客户端通过 HTTP 协议将配置文件下载到本地。")]),t._v(" "),a("p",[t._v("服务端通过配置文件中的 map 映射关系，将一个字符串匹配到一个服务端目录。")]),t._v(" "),a("p",[t._v("客户端请求服务端时,通过 url 中携带"),a("code",[t._v("id")]),t._v("参数，服务端根据"),a("code",[t._v("id")]),t._v("参数匹配到对应的目录，返回目录下文件的 json 列表。然后客户端再根据 json 列表中的文件名，下载文件到本地。 下载过程中，客户端会根据服务端返回的文件的 md5 值，判断本地文件是否需要更新。")]),t._v(" "),a("h2",{attrs:{id:"docker-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署"}},[t._v("#")]),t._v(" Docker 部署")]),t._v(" "),a("h3",{attrs:{id:"服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端"}},[t._v("#")]),t._v(" 服务端")]),t._v(" "),a("p",[t._v("docker-compose.yml 文件如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config-deliver-server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gcslaoli/config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deliver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./config.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/app/config.yaml\n")])])]),a("p",[t._v("config.yaml 文件如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('":8000"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dirmap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("5472E3F6-37DE-B9A0-899C-39838E8C1336")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./\n")])])]),a("h3",{attrs:{id:"客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[t._v("#")]),t._v(" 客户端")]),t._v(" "),a("p",[t._v("docker-compose.yml 文件如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config-deliver-client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gcslaoli/config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deliver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./config.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/app/config.yaml\n")])])]),a("p",[t._v("config.yaml 文件如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8000/getconfig "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# api server address")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5472E3F6-37DE-B9A0-899C-39838E8C1336"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 任务名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件名, * 表示所有文件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("corn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@every 1m"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# corn表达式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./temp/test"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本地目录")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("isRunOnStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否启动时执行一次")]),t._v("\n")])])]),a("h2",{attrs:{id:"dockerhub"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerhub"}},[t._v("#")]),t._v(" DockerHub")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/gcslaoli/config-deliver-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("config-deliver-server"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/gcslaoli/config-deliver-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("config-deliver-client"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"版本号规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本号规则"}},[t._v("#")]),t._v(" 版本号规则")]),t._v(" "),a("p",[t._v("版本号规则为"),a("code",[t._v("v1.0.0")]),t._v("，其中"),a("code",[t._v("v")]),t._v("表示版本号，"),a("code",[t._v("1")]),t._v("表示主版本号，"),a("code",[t._v("0")]),t._v("表示次版本号，"),a("code",[t._v("0")]),t._v("表示修订版本号。")]),t._v(" "),a("p",[t._v("DockerHub 中的镜像版本号为"),a("code",[t._v("1.0.0")]),t._v("，其中"),a("code",[t._v("1")]),t._v("表示主版本号，"),a("code",[t._v("0")]),t._v("表示次版本号，"),a("code",[t._v("0")]),t._v("表示修订版本号。每次更新镜像时，会将镜像的版本号更新为最新的版本号。")])])}),[],!1,null,null,null);a.default=n.exports}}]);